(()=>{"use strict";const e={modal:null,providersContainer:null,closeBtn:null,providers:null,redirectUrl:null,init(){if(this.modal=document.querySelector(".login-modal"),this.providersContainer=document.querySelector(".login-providers"),this.closeBtn=document.querySelector(".login-close"),!this.modal)return;const e=document.querySelector(".login-toggle");e&&e.addEventListener("click",()=>this.open()),this.closeBtn&&this.closeBtn.addEventListener("click",()=>this.close()),this.modal.addEventListener("click",e=>{e.target===this.modal&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.modal.classList.contains("active")&&this.close()})},async open(e=null){if(!this.modal)return;this.redirectUrl=e||window.location.pathname,this.modal.classList.add("active"),this.providers?this.renderProviders():await this.loadProviders()},close(){if(!this.modal)return;this.modal.classList.remove("active")},async loadProviders(){this.providersContainer.innerHTML='<div class="login-loading">Loading...</div>';try{const e=await fetch("/api/auth/providers");if(!e.ok)throw new Error("Failed to load providers");const t=await e.json();this.providers=t.providers||[],this.renderProviders()}catch(e){console.error("Failed to load auth providers:",e),this.providersContainer.innerHTML='<div class="login-loading">Failed to load sign in options</div>'}},renderProviders(){if(!this.providers||this.providers.length===0){this.providersContainer.innerHTML='<div class="login-loading">No sign in options available</div>';return}const e={google:`<svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>`,github:`<svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/></svg>`};this.providersContainer.innerHTML=this.providers.map(t=>{const n=e[t.id]||"",s=encodeURIComponent(this.redirectUrl);return`<a href="/auth/${t.id}?redirect=${s}" class="login-provider-btn">
                    ${n}
                    <span>Continue with ${t.name}</span>
                </a>`}).join("")}},t={init(){this.initMobileMenu(),this.initSearch(),this.initCollectionSort(),this.initReactions(),this.initComments()},initMobileMenu(){const e=document.querySelector(".menu-toggle"),t=document.querySelector(".sidebar-overlay"),n=document.querySelector(".sidebar");e&&!e.dataset.initialized&&(e.dataset.initialized="true",e.addEventListener("click",()=>{if(n){document.body.classList.toggle("sidebar-open");const t=document.body.classList.contains("sidebar-open");e.setAttribute("aria-expanded",t)}else{document.body.classList.toggle("nav-open");const t=document.body.classList.contains("nav-open");e.setAttribute("aria-expanded",t)}})),t&&!t.dataset.initialized&&(t.dataset.initialized="true",t.addEventListener("click",()=>{document.body.classList.remove("sidebar-open","nav-open"),e&&e.setAttribute("aria-expanded","false")}))},initSearch(){const a=document.querySelector(".search-toggle"),e=document.querySelector(".search-modal"),n=document.querySelector(".search-input"),c=document.querySelector(".search-close"),t=document.querySelector(".search-results");if(!a||!e)return;let r,o=0;a.addEventListener("click",()=>{o=window.scrollY,document.body.style.top=`-${o}px`,document.body.classList.add("modal-open"),e.classList.add("active"),n.focus()});const s=()=>{document.body.classList.remove("modal-open"),document.body.style.top="",window.scrollTo(0,o),e.classList.remove("active"),n.value="",t.innerHTML=""};c.addEventListener("click",s),e.addEventListener("click",t=>{t.target===e&&s()}),document.addEventListener("keydown",t=>{t.key==="Escape"&&e.classList.contains("active")&&s(),(t.metaKey||t.ctrlKey)&&t.key==="k"&&(t.preventDefault(),e.classList.add("active"),n.focus())}),n.addEventListener("input",e=>{const n=e.target.value.trim();if(clearTimeout(r),!n){t.innerHTML="";return}t.innerHTML='<div class="search-loading">Searching...</div>',r=setTimeout(async()=>{try{const e=await fetch(`/api/search?q=${encodeURIComponent(n)}`);if(!e.ok)throw new Error("Search failed");const o=await e.json();if(o.length===0){t.innerHTML=`<div class="search-empty">No results for '${i(n)}'</div>`;return}t.innerHTML=o.map(e=>`
                            <a href="${e.URL}" class="search-result">
                                <div class="search-result-title">${i(e.Title)}</div>
                                <div class="search-result-meta">
                                    <span class="search-result-type">${e.Type}</span>
                                    ${e.Date?`<span>â€¢</span><span>${l(e.Date)}</span>`:""}
                                </div>
                                <div class="search-result-snippet">${e.Snippet}</div>
                            </a>
                        `).join(""),t.querySelectorAll(".search-result").forEach(e=>{e.addEventListener("click",()=>{s()})})}catch(e){console.error("Search error:",e),t.innerHTML=`<div class="search-empty">No results for '${i(n)}'</div>`}},300)});function i(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function l(e){const t=new Date(e);return t.toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})}},initCollectionSort(){const e=document.querySelector(".sort-select"),t=document.querySelector(".posts-list-blog");if(!e||!t)return;const n=e.hasAttribute("data-blog-sort");if(n){const s=new URLSearchParams(window.location.search),o=s.get("sort"),n=o==="oldest"?"oldest":"newest";e.value=n,this.sortPosts(t,n),e.addEventListener("change",e=>{const n=e.target.value,s=new URL(window.location.href);n==="newest"?s.searchParams.delete("sort"):s.searchParams.set("sort",n),window.history.replaceState({},"",s),this.sortPosts(t,n)})}else{const n=localStorage.getItem("collectionSort")||"newest";e.value=n,this.sortPosts(t,n),e.addEventListener("change",e=>{const n=e.target.value;localStorage.setItem("collectionSort",n),this.sortPosts(t,n)})}},sortPosts(e,t){const n=Array.from(e.querySelectorAll(".post-card"));n.sort((e,n)=>{const s=parseInt(e.dataset.date),o=parseInt(n.dataset.date),i=parseInt(e.dataset.updated),a=parseInt(n.dataset.updated);switch(t){case"newest":return o-s;case"oldest":return s-o;case"updated":return a-i;default:return o-s}}),n.forEach(t=>e.appendChild(t))},initReactions(){const e=document.querySelector(".reactions");if(!e)return;const t=e.dataset.post;if(!t)return;if(e.dataset.initialized===t)return;e.dataset.initialized=t,new s(e,t)},initComments(){const e=document.querySelector(".comments-section");if(!e)return;const t=e.dataset.post;if(!t)return;if(e.dataset.initialized===t)return;e.dataset.initialized=t,new o(e,t)}};class s{constructor(e,t){this.container=e,this.postSlug=t,this.userReactions=[],this.isLoggedIn=!1,this.init()}async init(){this.attachHandlers(),await Promise.all([this.fetchReactions(),this.fetchUserReactions()])}attachHandlers(){this.container.querySelectorAll(".reaction-btn").forEach(e=>{e.addEventListener("click",()=>this.toggleReaction(e.dataset.emoji))})}async fetchReactions(){try{const e=await fetch(`/api/reactions?post=${encodeURIComponent(this.postSlug)}`);if(e.ok){const t=await e.json();this.updateCounts(t)}}catch(e){console.error("Failed to fetch reactions:",e)}}async fetchUserReactions(){try{const e=await fetch(`/api/reactions/user?post=${encodeURIComponent(this.postSlug)}`);e.ok?(this.userReactions=await e.json(),this.isLoggedIn=!0,this.updateActiveStates()):e.status===401&&(this.isLoggedIn=!1)}catch(e){console.error("Failed to fetch user reactions:",e)}}updateCounts(e){const t=Object.fromEntries(e.map(e=>[e.emoji,{count:e.count,users:e.users||[]}]));this.container.querySelectorAll(".reaction-btn").forEach(e=>{const o=e.dataset.emoji,n=t[o]||{count:0,users:[]},s=e.querySelector(".count");s&&(s.textContent=n.count),e.title=this.buildTooltip(n.users,n.count)})}buildTooltip(e,t){if(t===0||e.length===0)return"";if(t===1)return e[0];if(t===2)return`${e[0]} and ${e[1]}`;if(t===3&&e.length===3)return`${e[0]}, ${e[1]} and ${e[2]}`;const n=t-e.length;return n>0?`${e.slice(0,2).join(", ")} and ${n+(e.length>2?1:0)} others`:`${e.slice(0,-1).join(", ")} and ${e[e.length-1]}`}updateActiveStates(){this.container.querySelectorAll(".reaction-btn").forEach(e=>{e.classList.toggle("active",this.userReactions.includes(e.dataset.emoji))})}async toggleReaction(t){if(!this.isLoggedIn){e.open(window.location.pathname);return}try{const e=await fetch("/api/reactions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({post:this.postSlug,emoji:t})});if(e.ok){const n=await e.json();n.added?this.userReactions.push(t):this.userReactions=this.userReactions.filter(e=>e!==t),this.updateActiveStates(),await this.fetchReactions()}}catch(e){console.error("Failed to toggle reaction:",e)}}}class o{constructor(e,t){this.container=e,this.postSlug=t,this.isLoggedIn=!1,this.currentUser=null,this.comments=[],this.isPreviewMode=!1,this.editingCommentId=null,this.form=e.querySelector(".comment-form"),this.textarea=e.querySelector(".comment-input"),this.preview=e.querySelector(".comment-preview"),this.previewToggle=e.querySelector(".preview-toggle"),this.submitBtn=e.querySelector(".comment-submit"),this.commentsList=e.querySelector(".comments-list"),this.avatarPlaceholder=e.querySelector(".avatar-placeholder"),this.init()}async init(){this.attachHandlers(),await Promise.all([this.checkAuth(),this.fetchComments()]),this.updateFormState()}attachHandlers(){this.submitBtn.addEventListener("click",()=>this.submitComment()),this.previewToggle.addEventListener("click",()=>this.togglePreview()),this.textarea.addEventListener("input",()=>{this.submitBtn.disabled=!this.textarea.value.trim(),this.isPreviewMode&&this.renderPreview()}),this.textarea.addEventListener("keydown",e=>{(e.ctrlKey||e.metaKey)&&e.key==="Enter"&&this.textarea.value.trim()&&this.submitComment()})}async checkAuth(){try{const e=await fetch("/api/me");e.ok&&(this.currentUser=await e.json(),this.isLoggedIn=!0)}catch(e){console.error("Failed to check auth:",e)}}updateFormState(){this.isLoggedIn&&this.currentUser?(this.textarea.disabled=!1,this.textarea.placeholder="Write a comment... (Markdown supported)",this.currentUser.avatar?this.avatarPlaceholder.innerHTML=`<img src="${this.currentUser.avatar}" alt="${this.currentUser.name}" class="comment-avatar-img">`:this.avatarPlaceholder.innerHTML=`<span class="avatar-initial">${(this.currentUser.name||"U")[0].toUpperCase()}</span>`):(this.textarea.disabled=!0,this.textarea.placeholder="Sign in to comment",this.submitBtn.disabled=!0)}async fetchComments(){try{const e=await fetch(`/api/comments?post=${encodeURIComponent(this.postSlug)}`);e.ok&&(this.comments=await e.json(),this.renderComments())}catch(e){console.error("Failed to fetch comments:",e)}}renderComments(){if(!this.comments||this.comments.length===0){this.commentsList.innerHTML='<p class="no-comments">No comments yet. Be the first to comment!</p>';return}this.commentsList.innerHTML=this.comments.map(e=>this.renderComment(e)).join(""),this.commentsList.querySelectorAll(".comment-edit-btn").forEach(e=>{e.addEventListener("click",()=>this.startEdit(parseInt(e.dataset.id)))}),this.commentsList.querySelectorAll(".comment-delete-btn").forEach(e=>{e.addEventListener("click",()=>this.deleteComment(parseInt(e.dataset.id)))}),this.commentsList.querySelectorAll(".comment-save-btn").forEach(e=>{e.addEventListener("click",()=>this.saveEdit(parseInt(e.dataset.id)))}),this.commentsList.querySelectorAll(".comment-cancel-btn").forEach(e=>{e.addEventListener("click",()=>this.cancelEdit(parseInt(e.dataset.id)))})}renderComment(e){const n=this.currentUser&&e.userId===this.currentUser.id,s=e.userAvatar?`<img src="${e.userAvatar}" alt="${e.userName}" class="comment-avatar-img">`:`<span class="avatar-initial">${(e.userName||"U")[0].toUpperCase()}</span>`,t=new Date(e.createdAt),o=this.formatTimeAgo(t),i=e.updatedAt!==e.createdAt;return`
                <div class="comment" data-id="${e.id}">
                    <div class="comment-avatar">${s}</div>
                    <div class="comment-main">
                        <div class="comment-header">
                            <span class="comment-author">${this.escapeHtml(e.userName)}</span>
                            <span class="comment-time" title="${t.toLocaleString()}">${o}${i?" (edited)":""}</span>
                            ${n?`
                                <div class="comment-actions">
                                    <button class="comment-edit-btn" data-id="${e.id}">Edit</button>
                                    <button class="comment-delete-btn" data-id="${e.id}">Delete</button>
                                </div>
                            `:""}
                        </div>
                        <div class="comment-body">${e.contentHtml}</div>
                        <div class="comment-edit-form" style="display: none;">
                            <textarea class="comment-edit-input">${this.escapeHtml(e.content)}</textarea>
                            <div class="comment-edit-actions">
                                <button class="comment-cancel-btn" data-id="${e.id}">Cancel</button>
                                <button class="comment-save-btn" data-id="${e.id}">Save</button>
                            </div>
                        </div>
                    </div>
                </div>
            `}formatTimeAgo(e){const t=Math.floor((new Date-e)/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:t<604800?`${Math.floor(t/86400)}d ago`:e.toLocaleDateString("en-US",{month:"short",day:"numeric"})}escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}togglePreview(){this.isPreviewMode=!this.isPreviewMode,this.isPreviewMode?(this.renderPreview(),this.preview.style.display="block",this.textarea.style.display="none",this.previewToggle.textContent="Edit"):(this.preview.style.display="none",this.textarea.style.display="block",this.previewToggle.textContent="Preview")}renderPreview(){const e=this.textarea.value;if(!e.trim()){this.preview.innerHTML='<p class="preview-empty">Nothing to preview</p>';return}this.preview.innerHTML=this.simpleMarkdown(e)}simpleMarkdown(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/```(\w*)\n([\s\S]*?)```/g,"<pre><code>$2</code></pre>").replace(/`([^`]+)`/g,"<code>$1</code>").replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>").replace(/__([^_]+)__/g,"<strong>$1</strong>").replace(/\*([^*]+)\*/g,"<em>$1</em>").replace(/_([^_]+)_/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank" rel="noopener">$1</a>').replace(/\n/g,"<br>")}async submitComment(){if(!this.isLoggedIn){e.open(window.location.pathname);return}const t=this.textarea.value.trim();if(!t)return;this.submitBtn.disabled=!0,this.submitBtn.textContent="Posting...";try{const e=await fetch("/api/comments",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({post:this.postSlug,content:t})});if(e.ok){const t=await e.json();this.comments.unshift(t),this.renderComments(),this.textarea.value="",this.isPreviewMode&&this.togglePreview()}else throw new Error("Failed to post comment")}catch(e){console.error("Failed to post comment:",e),alert("Failed to post comment. Please try again.")}finally{this.submitBtn.disabled=!1,this.submitBtn.textContent="Comment"}}startEdit(e){const t=this.container.querySelector(`.comment[data-id="${e}"]`);if(!t)return;t.querySelector(".comment-body").style.display="none",t.querySelector(".comment-actions").style.display="none",t.querySelector(".comment-edit-form").style.display="block"}cancelEdit(e){const t=this.container.querySelector(`.comment[data-id="${e}"]`);if(!t)return;const n=this.comments.find(t=>t.id===e);n&&(t.querySelector(".comment-edit-input").value=n.content),t.querySelector(".comment-body").style.display="block",t.querySelector(".comment-actions").style.display="flex",t.querySelector(".comment-edit-form").style.display="none"}async saveEdit(e){const n=this.container.querySelector(`.comment[data-id="${e}"]`);if(!n)return;const o=n.querySelector(".comment-edit-input"),s=o.value.trim();if(!s)return;const t=n.querySelector(".comment-save-btn");t.disabled=!0,t.textContent="Saving...";try{const t=await fetch(`/api/comments/${e}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:s})});if(t.ok){const s=await t.json(),n=this.comments.findIndex(t=>t.id===e);n!==-1&&(this.comments[n]=s),this.renderComments()}else throw new Error("Failed to update comment")}catch(e){console.error("Failed to update comment:",e),alert("Failed to update comment. Please try again."),t.disabled=!1,t.textContent="Save"}}async deleteComment(e){if(!confirm("Are you sure you want to delete this comment?"))return;try{const t=await fetch(`/api/comments/${e}`,{method:"DELETE"});if(t.ok)this.comments=this.comments.filter(t=>t.id!==e),this.renderComments();else throw new Error("Failed to delete comment")}catch(e){console.error("Failed to delete comment:",e),alert("Failed to delete comment. Please try again.")}}}const i={init(){document.addEventListener("keydown",e=>{if(e.key==="Escape"&&(document.body.classList.contains("sidebar-open")||document.body.classList.contains("nav-open"))){document.body.classList.remove("sidebar-open","nav-open");const e=document.querySelector(".menu-toggle");e&&e.setAttribute("aria-expanded","false")}})}},n={dropdown:null,toggle:null,user:null,init(){this.dropdown=document.querySelector(".profile-dropdown"),this.toggle=document.querySelector(".profile-toggle"),this.dropdown&&this.toggle&&this.attachHandlers(),this.hydrateUser()},attachHandlers(){if(this.toggle.dataset.initialized)return;this.toggle.dataset.initialized="true",this.toggle.addEventListener("click",e=>{e.stopPropagation(),this.toggleMenu()}),document.addEventListener("click",e=>{this.dropdown&&!this.dropdown.contains(e.target)&&this.close()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.dropdown&&this.dropdown.classList.contains("open")&&this.close()})},async hydrateUser(){try{const e=await fetch("/api/me");if(!e.ok)return;this.user=await e.json(),this.updateHeader()}catch{}},updateHeader(){if(!this.user)return;const e=document.querySelector(".header-actions");if(!e)return;if(e.querySelector(".profile-dropdown"))return;const t=this.user.avatar?`<img src="${this.user.avatar}" alt="${this.user.name}" class="profile-avatar" />`:`<span class="profile-avatar-initial">${(this.user.name||"U")[0].toUpperCase()}</span>`;e.innerHTML=`
        <div class="profile-dropdown">
          <button class="profile-toggle" aria-expanded="false" aria-haspopup="true">
            ${t}
            <svg class="profile-chevron" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <polyline points="6 9 12 15 18 9"></polyline>
            </svg>
          </button>
          <div class="profile-menu">
            <div class="profile-menu-header">
              <span class="profile-menu-name">${this.escapeHtml(this.user.name)}</span>
              ${this.user.email?`<span class="profile-menu-email">${this.escapeHtml(this.user.email)}</span>`:""}
            </div>
            <div class="profile-menu-divider"></div>
            <a href="/auth/logout?redirect=${encodeURIComponent(window.location.pathname)}" class="profile-menu-item" data-no-router>
              <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                <polyline points="16 17 21 12 16 7"></polyline>
                <line x1="21" y1="12" x2="9" y2="12"></line>
              </svg>
              Sign out
            </a>
          </div>
        </div>
      `,this.dropdown=e.querySelector(".profile-dropdown"),this.toggle=e.querySelector(".profile-toggle"),this.attachHandlers()},escapeHtml(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML},toggleMenu(){if(!this.dropdown)return;const e=this.dropdown.classList.toggle("open");this.toggle.setAttribute("aria-expanded",e)},close(){if(!this.dropdown)return;this.dropdown.classList.remove("open"),this.toggle.setAttribute("aria-expanded","false")}},a={cache:new Map,currentUser:null,isNavigating:!1,prefetchQueue:new Set,prefetching:new Set,maxConcurrentPrefetch:3,shouldPrefetch:!0,onPageLoad:null,init(){this.checkPrefetchPreferences(),this.loadUserState(),document.addEventListener("click",e=>{const t=e.target.closest("a");if(!t)return;const n=t.getAttribute("href");if(!this.shouldInterceptLink(t,n))return;e.preventDefault(),this.navigate(n)}),window.addEventListener("popstate",e=>{e.state&&e.state.path&&this.loadPage(e.state.path,!1)}),history.replaceState({path:location.pathname},"",location.pathname),this.setupPrefetching()},checkPrefetchPreferences(){const e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;if(e?.saveData){this.shouldPrefetch=!1;return}if(e?.effectiveType==="slow-2g"||e?.effectiveType==="2g"){this.shouldPrefetch=!1;return}},setupPrefetching(){if(!this.shouldPrefetch)return;const e=()=>{this.setupViewportPrefetching(),this.setupHoverPrefetching(),this.setupTouchPrefetching()};document.readyState==="complete"?"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3):window.addEventListener("load",()=>{"requestIdleCallback"in window?requestIdleCallback(e,{timeout:2e3}):setTimeout(e,1e3)})},setupViewportPrefetching(){if(!("IntersectionObserver"in window))return;const t=new IntersectionObserver(e=>{e.forEach(e=>{if(e.isIntersecting){const t=e.target.href;this.shouldPrefetchUrl(t)&&this.prefetchQueue.add(t)}}),"requestIdleCallback"in window?requestIdleCallback(()=>this.processPrefetchQueue()):setTimeout(()=>this.processPrefetchQueue(),0)},{rootMargin:"50px",threshold:.01}),e=()=>{document.querySelectorAll("a[href]").forEach(e=>{const n=e.getAttribute("href");this.shouldInterceptLink(e,n)&&t.observe(e)})};e(),this.onPageLoad=e},setupHoverPrefetching(){let e;document.addEventListener("mouseover",t=>{const n=t.target.closest("a");if(!n)return;const s=n.getAttribute("href");if(!this.shouldInterceptLink(n,s))return;e=setTimeout(()=>{this.prefetch(s)},200)},{passive:!0}),document.addEventListener("mouseout",()=>{e&&(clearTimeout(e),e=null)},{passive:!0})},setupTouchPrefetching(){document.addEventListener("touchstart",e=>{const t=e.target.closest("a");if(!t)return;const n=t.getAttribute("href");this.shouldInterceptLink(t,n)&&this.prefetch(n)},{passive:!0})},processPrefetchQueue(){const t=this.prefetching.size,e=this.maxConcurrentPrefetch-t;if(e<=0)return;const n=Array.from(this.prefetchQueue).filter(e=>!this.cache.has(e)&&!this.prefetching.has(e)).slice(0,e);n.forEach(e=>{this.prefetchQueue.delete(e),this.prefetch(e)})},async prefetch(e){if(!e||this.cache.has(e)||this.prefetching.has(e))return;this.prefetching.add(e);try{const t=await fetch(e);if(t.ok){const n=await t.text();this.cache.set(e,n)}}catch{}finally{this.prefetching.delete(e),this.prefetchQueue.size>0&&this.processPrefetchQueue()}},shouldInterceptLink(e,t){return!!t&&!t.startsWith("#")&&!(t.startsWith("http")&&!t.startsWith(location.origin))&&!t.startsWith("mailto:")&&!t.startsWith("tel:")&&!e.hasAttribute("download")&&e.target!=="_blank"&&!e.closest("[data-no-router]")&&!t.includes("/auth/")&&!t.includes("/api/")},shouldPrefetchUrl(e){return!!e&&e!==location.pathname&&!this.cache.has(e)&&!this.prefetching.has(e)},async navigate(e){if(this.isNavigating||e===location.pathname)return;this.isNavigating=!0,document.body.classList.add("page-loading");try{history.pushState({path:e},"",e),await this.loadPage(e,!0)}catch(t){console.error("Navigation error:",t),location.href=e}finally{this.isNavigating=!1,document.body.classList.remove("page-loading")}},async loadPage(e){let o=this.cache.get(e);if(!o){const t=await fetch(e);if(!t.ok)throw new Error(`Failed to load ${e}`);o=await t.text(),this.cache.set(e,o)}this.updateContent(o,e),e.includes("#")||window.scrollTo({top:0,behavior:"instant"}),document.body.classList.remove("sidebar-open","nav-open");const i=document.querySelector(".menu-toggle");i&&i.setAttribute("aria-expanded","false"),t.init(),n.init(),this.onPageLoad&&this.onPageLoad()},updateContent(e,t){const d=new DOMParser,n=d.parseFromString(e,"text/html"),s=n.querySelector("#main-content"),o=document.querySelector("#main-content");s&&o&&(o.innerHTML=s.innerHTML);const i=n.querySelector("title");i&&(document.title=i.textContent),this.updateActiveNav(t);const a=document.querySelector('link[rel="canonical"]'),r=n.querySelector('link[rel="canonical"]');a&&r&&(a.href=r.href);const c=document.querySelector('meta[name="description"]'),l=n.querySelector('meta[name="description"]');c&&l&&(c.content=l.content)},updateActiveNav(e){document.querySelectorAll(".site-nav a").forEach(t=>{t.classList.remove("active");const n=t.getAttribute("href");(e===n||n!=="/"&&e.startsWith(n))&&t.classList.add("active")})},loadUserState(){const e=document.querySelector(".profile-menu-name");e&&(this.currentUser={name:e.textContent})}};e.init(),t.init(),i.init(),n.init(),a.init()})()